<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Job Scout ‚Äî Find Hidden Opportunities</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=DM+Mono:wght@300;400;500&family=DM+Sans:wght@300;400;500;600&display=swap');

  :root {
    --bg: #0d0f0e;
    --surface: #141614;
    --surface2: #1a1c1a;
    --border: #2a2e2a;
    --accent: #b8f05a;
    --accent-dim: #7aab2a;
    --text: #e8ede8;
    --text-muted: #7a8a7a;
    --text-dim: #4a5a4a;
    --red: #ff6b6b;
    --amber: #f5a623;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'DM Sans', sans-serif;
    min-height: 100vh;
    line-height: 1.6;
  }

  /* NOISE TEXTURE */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.04'/%3E%3C/svg%3E");
    pointer-events: none;
    z-index: 0;
    opacity: 0.4;
  }

  .container {
    max-width: 1100px;
    margin: 0 auto;
    padding: 0 24px;
    position: relative;
    z-index: 1;
  }

  /* HEADER */
  header {
    padding: 48px 0 32px;
    border-bottom: 1px solid var(--border);
  }

  .header-inner {
    display: flex;
    align-items: flex-end;
    justify-content: space-between;
    gap: 24px;
    flex-wrap: wrap;
  }

  .logo-block h1 {
    font-family: 'DM Serif Display', serif;
    font-size: clamp(2rem, 5vw, 3.2rem);
    font-weight: 400;
    color: var(--text);
    letter-spacing: -0.02em;
    line-height: 1;
  }

  .logo-block h1 span {
    color: var(--accent);
    font-style: italic;
  }

  .logo-block p {
    font-family: 'DM Mono', monospace;
    font-size: 0.72rem;
    color: var(--text-muted);
    letter-spacing: 0.1em;
    text-transform: uppercase;
    margin-top: 8px;
  }

  .api-key-section {
    display: flex;
    align-items: center;
    gap: 10px;
    flex-wrap: wrap;
  }

  .api-key-section label {
    font-family: 'DM Mono', monospace;
    font-size: 0.7rem;
    color: var(--text-muted);
    letter-spacing: 0.08em;
    text-transform: uppercase;
  }

  /* INPUTS */
  input[type="text"], input[type="password"], input[type="number"], select, textarea {
    background: var(--surface2);
    border: 1px solid var(--border);
    color: var(--text);
    border-radius: 6px;
    font-family: 'DM Sans', sans-serif;
    font-size: 0.875rem;
    transition: border-color 0.15s, box-shadow 0.15s;
    outline: none;
  }

  input[type="text"]:focus, input[type="password"]:focus, input[type="number"]:focus, select:focus, textarea:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 3px rgba(184, 240, 90, 0.08);
  }

  input[type="password"] {
    padding: 8px 12px;
    width: 240px;
    font-family: 'DM Mono', monospace;
    font-size: 0.8rem;
  }

  /* MAIN LAYOUT */
  .main {
    display: grid;
    grid-template-columns: 340px 1fr;
    gap: 24px;
    padding: 32px 0 60px;
    align-items: start;
  }

  @media (max-width: 800px) {
    .main { grid-template-columns: 1fr; }
  }

  /* SIDEBAR / FILTERS */
  .sidebar {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 24px;
    position: sticky;
    top: 24px;
  }

  .sidebar-title {
    font-family: 'DM Mono', monospace;
    font-size: 0.68rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--text-muted);
    margin-bottom: 20px;
    padding-bottom: 12px;
    border-bottom: 1px solid var(--border);
  }

  .field-group {
    margin-bottom: 18px;
  }

  .field-group label {
    display: block;
    font-size: 0.78rem;
    font-weight: 500;
    color: var(--text-muted);
    margin-bottom: 6px;
    letter-spacing: 0.02em;
  }

  .field-group label .optional {
    font-weight: 300;
    color: var(--text-dim);
    font-size: 0.7rem;
    margin-left: 4px;
  }

  .field-group input[type="text"],
  .field-group input[type="number"],
  .field-group select,
  .field-group textarea {
    width: 100%;
    padding: 9px 12px;
  }

  .field-group textarea {
    resize: vertical;
    min-height: 70px;
    font-size: 0.82rem;
    line-height: 1.5;
  }

  select option {
    background: var(--surface2);
  }

  /* TOGGLE ROW */
  .toggle-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 8px 0;
    border-bottom: 1px solid var(--border);
  }

  .toggle-row:last-child { border-bottom: none; }

  .toggle-label {
    font-size: 0.82rem;
    color: var(--text);
  }

  .toggle-label .sub {
    display: block;
    font-size: 0.7rem;
    color: var(--text-dim);
    margin-top: 1px;
  }

  /* TOGGLE SWITCH */
  .toggle {
    position: relative;
    width: 36px;
    height: 20px;
    flex-shrink: 0;
  }

  .toggle input { opacity: 0; width: 0; height: 0; }

  .toggle-track {
    position: absolute;
    inset: 0;
    background: var(--border);
    border-radius: 20px;
    cursor: pointer;
    transition: background 0.2s;
  }

  .toggle-track::after {
    content: '';
    position: absolute;
    left: 3px;
    top: 3px;
    width: 14px;
    height: 14px;
    background: var(--text-muted);
    border-radius: 50%;
    transition: transform 0.2s, background 0.2s;
  }

  .toggle input:checked + .toggle-track { background: var(--accent-dim); }
  .toggle input:checked + .toggle-track::after {
    transform: translateX(16px);
    background: var(--accent);
  }

  .conditional-field {
    display: none;
    margin-top: 10px;
  }

  .conditional-field.visible { display: block; }

  /* SECTION DIVIDER */
  .section-divider {
    font-family: 'DM Mono', monospace;
    font-size: 0.65rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--text-dim);
    margin: 20px 0 14px;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .section-divider::after {
    content: '';
    flex: 1;
    height: 1px;
    background: var(--border);
  }

  /* SEARCH BUTTON */
  .search-btn {
    width: 100%;
    padding: 13px;
    background: var(--accent);
    color: #0d0f0e;
    border: none;
    border-radius: 8px;
    font-family: 'DM Sans', sans-serif;
    font-weight: 600;
    font-size: 0.9rem;
    cursor: pointer;
    letter-spacing: 0.02em;
    transition: opacity 0.15s, transform 0.1s;
    margin-top: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
  }

  .search-btn:hover { opacity: 0.9; }
  .search-btn:active { transform: scale(0.99); }
  .search-btn:disabled { opacity: 0.4; cursor: not-allowed; transform: none; }

  .search-btn .spinner {
    width: 16px;
    height: 16px;
    border: 2px solid rgba(0,0,0,0.3);
    border-top-color: #000;
    border-radius: 50%;
    animation: spin 0.7s linear infinite;
    display: none;
  }

  .search-btn.loading .spinner { display: block; }
  .search-btn.loading .btn-text { opacity: 0.6; }

  @keyframes spin { to { transform: rotate(360deg); } }

  /* RESULTS PANEL */
  .results-panel {
    min-height: 400px;
  }

  .results-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 20px;
  }

  .results-title {
    font-family: 'DM Serif Display', serif;
    font-size: 1.4rem;
    font-weight: 400;
    color: var(--text);
  }

  .results-count {
    font-family: 'DM Mono', monospace;
    font-size: 0.72rem;
    color: var(--text-muted);
    background: var(--surface2);
    border: 1px solid var(--border);
    padding: 4px 10px;
    border-radius: 20px;
  }

  /* EMPTY STATE */
  .empty-state {
    text-align: center;
    padding: 80px 20px;
    color: var(--text-dim);
  }

  .empty-state .icon {
    font-size: 3rem;
    margin-bottom: 16px;
    opacity: 0.4;
  }

  .empty-state p {
    font-size: 0.875rem;
    line-height: 1.7;
    max-width: 320px;
    margin: 0 auto;
  }

  /* JOB CARD */
  .job-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 20px 22px;
    margin-bottom: 14px;
    transition: border-color 0.15s, transform 0.1s;
    animation: fadeUp 0.3s ease both;
  }

  .job-card:hover {
    border-color: var(--accent-dim);
    transform: translateY(-1px);
  }

  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .job-card-header {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: 12px;
    margin-bottom: 10px;
  }

  .job-title {
    font-family: 'DM Serif Display', serif;
    font-size: 1.05rem;
    font-weight: 400;
    color: var(--text);
    line-height: 1.3;
  }

  .job-company {
    font-size: 0.82rem;
    color: var(--accent);
    font-weight: 500;
    margin-top: 3px;
  }

  .job-location {
    font-size: 0.78rem;
    color: var(--text-muted);
    margin-top: 2px;
    font-family: 'DM Mono', monospace;
  }

  .fit-badge {
    font-family: 'DM Mono', monospace;
    font-size: 0.68rem;
    letter-spacing: 0.06em;
    padding: 4px 10px;
    border-radius: 4px;
    white-space: nowrap;
    flex-shrink: 0;
  }

  .fit-high { background: rgba(184,240,90,0.12); color: var(--accent); border: 1px solid rgba(184,240,90,0.25); }
  .fit-med { background: rgba(245,166,35,0.1); color: var(--amber); border: 1px solid rgba(245,166,35,0.2); }
  .fit-low { background: rgba(255,107,107,0.1); color: var(--red); border: 1px solid rgba(255,107,107,0.2); }

  .job-meta {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin: 12px 0;
  }

  .meta-tag {
    font-family: 'DM Mono', monospace;
    font-size: 0.68rem;
    color: var(--text-muted);
    background: var(--surface2);
    border: 1px solid var(--border);
    padding: 3px 9px;
    border-radius: 4px;
    letter-spacing: 0.04em;
  }

  .meta-tag.highlight {
    color: var(--accent);
    border-color: rgba(184,240,90,0.2);
    background: rgba(184,240,90,0.05);
  }

  .job-summary {
    font-size: 0.83rem;
    color: var(--text-muted);
    line-height: 1.65;
    margin-bottom: 14px;
  }

  .job-card-footer {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
    padding-top: 12px;
    border-top: 1px solid var(--border);
    flex-wrap: wrap;
  }

  .visibility-note {
    font-size: 0.72rem;
    color: var(--text-dim);
    font-style: italic;
  }

  .apply-link {
    font-family: 'DM Mono', monospace;
    font-size: 0.72rem;
    color: var(--accent);
    text-decoration: none;
    border: 1px solid rgba(184,240,90,0.3);
    padding: 5px 14px;
    border-radius: 4px;
    letter-spacing: 0.06em;
    transition: background 0.15s;
  }

  .apply-link:hover { background: rgba(184,240,90,0.08); }

  /* STATUS BAR */
  .status-bar {
    font-family: 'DM Mono', monospace;
    font-size: 0.72rem;
    color: var(--text-muted);
    padding: 10px 14px;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 6px;
    margin-bottom: 20px;
    display: none;
  }

  .status-bar.visible { display: block; }

  .status-bar .dot {
    display: inline-block;
    width: 6px;
    height: 6px;
    background: var(--accent);
    border-radius: 50%;
    margin-right: 8px;
    animation: pulse 1.2s ease infinite;
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.3; }
  }

  /* ERROR */
  .error-msg {
    background: rgba(255,107,107,0.08);
    border: 1px solid rgba(255,107,107,0.25);
    color: var(--red);
    border-radius: 8px;
    padding: 14px 16px;
    font-size: 0.82rem;
    margin-bottom: 16px;
    display: none;
  }

  .error-msg.visible { display: block; }

  /* RANGE FIELDS */
  .range-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
  }

  .range-row input { padding: 9px 12px; width: 100%; }

  /* CHECKBOX GROUP */
  .checkbox-group {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
  }

  .chip-checkbox {
    display: flex;
    align-items: center;
    gap: 5px;
    font-size: 0.75rem;
    color: var(--text-muted);
    background: var(--surface2);
    border: 1px solid var(--border);
    padding: 4px 10px;
    border-radius: 20px;
    cursor: pointer;
    transition: all 0.15s;
    user-select: none;
  }

  .chip-checkbox input { display: none; }

  .chip-checkbox:has(input:checked) {
    background: rgba(184,240,90,0.1);
    border-color: rgba(184,240,90,0.35);
    color: var(--accent);
  }

  /* STREAMING TEXT */
  .streaming-output {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 20px;
    font-size: 0.82rem;
    line-height: 1.8;
    color: var(--text-muted);
    white-space: pre-wrap;
    display: none;
    margin-bottom: 16px;
    font-family: 'DM Mono', monospace;
    max-height: 300px;
    overflow-y: auto;
  }

  .streaming-output.visible { display: block; }
</style>
</head>
<body>

<div class="container">
  <header>
    <div class="header-inner">
      <div class="logo-block">
        <h1>Job <span>Scout</span></h1>
        <p>Surface overlooked opportunities ‚Äî AI-powered, precision-filtered</p>
      </div>
      <div class="api-key-section">
        <label for="apiKey">Anthropic API Key</label>
        <input type="password" id="apiKey" placeholder="sk-ant-..." />
      </div>
    </div>
  </header>

  <div class="main">
    <!-- SIDEBAR FILTERS -->
    <aside class="sidebar">
      <div class="sidebar-title">Search Filters</div>

      <div class="field-group">
        <label>Role / Job Title <span class="optional">*required</span></label>
        <input type="text" id="jobTitle" placeholder="e.g. BI Analyst, Data Analyst" />
      </div>

      <div class="field-group">
        <label>Location <span class="optional">optional</span></label>
        <input type="text" id="location" placeholder="e.g. Minneapolis MN, Remote, US" />
      </div>

      <div class="field-group">
        <label>Industry / Sector <span class="optional">optional</span></label>
        <input type="text" id="industry" placeholder="e.g. CPG, Energy, Mission-driven, B Corp" />
      </div>

      <div class="field-group">
        <label>Keywords / Skills <span class="optional">optional</span></label>
        <textarea id="keywords" placeholder="e.g. SQL, dbt, Tableau, demand forecasting, Oracle ERP"></textarea>
      </div>

      <div class="section-divider">Company Profile</div>

      <div class="field-group">
        <label>Company Size <span class="optional">optional</span></label>
        <select id="companySize">
          <option value="">Any size</option>
          <option value="startup">Startup (1‚Äì50)</option>
          <option value="small">Small (51‚Äì200)</option>
          <option value="mid">Mid-size (201‚Äì1000)</option>
          <option value="large">Large (1001‚Äì5000)</option>
          <option value="enterprise">Enterprise (5000+)</option>
        </select>
      </div>

      <!-- Funding Toggle -->
      <div class="toggle-row">
        <div class="toggle-label">
          Series Funding
          <span class="sub">Filter by VC/investment stage</span>
        </div>
        <label class="toggle">
          <input type="checkbox" id="fundingToggle" onchange="toggleConditional('fundingToggle','fundingFields')" />
          <span class="toggle-track"></span>
        </label>
      </div>
      <div class="conditional-field" id="fundingFields">
        <div class="field-group" style="margin-top:10px">
          <label>Funding Stage</label>
          <div class="checkbox-group">
            <label class="chip-checkbox"><input type="checkbox" name="fundingStage" value="seed" /> Seed</label>
            <label class="chip-checkbox"><input type="checkbox" name="fundingStage" value="series-a" /> Series A</label>
            <label class="chip-checkbox"><input type="checkbox" name="fundingStage" value="series-b" /> Series B</label>
            <label class="chip-checkbox"><input type="checkbox" name="fundingStage" value="series-c" /> Series C+</label>
            <label class="chip-checkbox"><input type="checkbox" name="fundingStage" value="public" /> Public</label>
            <label class="chip-checkbox"><input type="checkbox" name="fundingStage" value="bootstrapped" /> Bootstrapped</label>
          </div>
        </div>
        <div class="field-group">
          <label>Min. Total Funding <span class="optional">optional</span></label>
          <div class="range-row">
            <input type="text" id="fundingMin" placeholder="e.g. $5M" />
            <input type="text" id="fundingMax" placeholder="e.g. $100M" />
          </div>
        </div>
      </div>

      <div class="section-divider">Compensation</div>

      <div class="toggle-row">
        <div class="toggle-label">
          Pay Transparency
          <span class="sub">Include only roles with listed salary</span>
        </div>
        <label class="toggle">
          <input type="checkbox" id="payTransparency" />
          <span class="toggle-track"></span>
        </label>
      </div>

      <div class="field-group" style="margin-top:14px">
        <label>Salary Range <span class="optional">optional</span></label>
        <div class="range-row">
          <input type="text" id="salaryMin" placeholder="Min $" />
          <input type="text" id="salaryMax" placeholder="Max $" />
        </div>
      </div>

      <div class="toggle-row">
        <div class="toggle-label">
          Equity / Stock Options
          <span class="sub">Include total comp with equity data</span>
        </div>
        <label class="toggle">
          <input type="checkbox" id="equityToggle" />
          <span class="toggle-track"></span>
        </label>
      </div>

      <div class="section-divider">Work Style</div>

      <div class="field-group">
        <label>Work Arrangement</label>
        <div class="checkbox-group">
          <label class="chip-checkbox"><input type="checkbox" name="workArrangement" value="remote" /> Remote</label>
          <label class="chip-checkbox"><input type="checkbox" name="workArrangement" value="hybrid" /> Hybrid</label>
          <label class="chip-checkbox"><input type="checkbox" name="workArrangement" value="onsite" /> On-site</label>
        </div>
      </div>

      <div class="toggle-row">
        <div class="toggle-label">
          Work-Life Balance Signals
          <span class="sub">Look for PTO, culture, hours data</span>
        </div>
        <label class="toggle">
          <input type="checkbox" id="wlbToggle" />
          <span class="toggle-track"></span>
        </label>
      </div>

      <div class="section-divider">Sources</div>

      <div class="field-group">
        <label>Prefer niche/low-visibility sources</label>
        <div class="checkbox-group">
          <label class="chip-checkbox"><input type="checkbox" name="sources" value="company-careers" checked /> Direct careers pages</label>
          <label class="chip-checkbox"><input type="checkbox" name="sources" value="builtin" checked /> Built In</label>
          <label class="chip-checkbox"><input type="checkbox" name="sources" value="idealist" checked /> Idealist</label>
          <label class="chip-checkbox"><input type="checkbox" name="sources" value="bcorp" checked /> B Corp jobs</label>
          <label class="chip-checkbox"><input type="checkbox" name="sources" value="greenhouse" checked /> Greenhouse/Lever</label>
          <label class="chip-checkbox"><input type="checkbox" name="sources" value="remote" /> Remote boards</label>
          <label class="chip-checkbox"><input type="checkbox" name="sources" value="state" /> State job boards</label>
        </div>
      </div>

      <div class="field-group">
        <label>Additional context / notes <span class="optional">optional</span></label>
        <textarea id="additionalContext" placeholder="e.g. I have 10 years experience in BI at retail, Oracle ERP, GCP dashboards, Navy veteran..."></textarea>
      </div>

      <button class="search-btn" id="searchBtn" onclick="runSearch()">
        <div class="spinner"></div>
        <span class="btn-text">Find Opportunities</span>
      </button>
    </aside>

    <!-- RESULTS -->
    <main class="results-panel">
      <div class="results-header">
        <div class="results-title">Opportunities</div>
        <div class="results-count" id="resultsCount" style="display:none"></div>
      </div>

      <div class="status-bar" id="statusBar">
        <span class="dot"></span><span id="statusText">Searching across niche job boards and company career pages...</span>
      </div>

      <div class="error-msg" id="errorMsg"></div>

      <div class="streaming-output" id="streamingOutput"></div>

      <div id="resultsContainer">
        <div class="empty-state">
          <div class="icon">üîç</div>
          <p>Configure your filters and hit <strong>Find Opportunities</strong> to surface jobs that aren't drowning in LinkedIn noise.</p>
        </div>
      </div>
    </main>
  </div>
</div>

<script>
  function toggleConditional(toggleId, fieldId) {
    const toggle = document.getElementById(toggleId);
    const field = document.getElementById(fieldId);
    field.classList.toggle('visible', toggle.checked);
  }

  function getCheckedValues(name) {
    return Array.from(document.querySelectorAll(`input[name="${name}"]:checked`)).map(el => el.value);
  }

  function buildPrompt(filters) {
    let prompt = `You are a job search specialist helping a user find overlooked job opportunities that aren't heavily trafficked on LinkedIn or Indeed. Your task is to identify and describe specific real job opportunities or where to find them.

USER'S SEARCH CRITERIA:
- Role: ${filters.jobTitle}
${filters.location ? `- Location: ${filters.location}` : '- Location: Flexible/Open'}
${filters.industry ? `- Industry/Sector: ${filters.industry}` : ''}
${filters.keywords ? `- Skills/Keywords: ${filters.keywords}` : ''}
${filters.companySize ? `- Company Size: ${filters.companySize}` : ''}
${filters.workArrangements.length > 0 ? `- Work Arrangement: ${filters.workArrangements.join(', ')}` : ''}
${filters.salaryMin || filters.salaryMax ? `- Salary Range: ${filters.salaryMin || 'open'} to ${filters.salaryMax || 'open'}` : ''}
${filters.payTransparency ? '- IMPORTANT: Only include roles with salary listed publicly' : ''}
${filters.equity ? '- Include equity/stock options in compensation breakdown when available' : ''}
${filters.wlb ? '- Surface any work-life balance signals (PTO policy, culture notes, Glassdoor signals, hours expectations)' : ''}
${filters.funding ? `- Funding preference: ${filters.fundingStages.join(', ')}${filters.fundingMin ? `, min funding: ${filters.fundingMin}` : ''}${filters.fundingMax ? ` to ${filters.fundingMax}` : ''}` : ''}
${filters.sources.length > 0 ? `- Preferred sources: ${filters.sources.join(', ')}` : ''}
${filters.additionalContext ? `- Additional user context: ${filters.additionalContext}` : ''}

INSTRUCTIONS:
1. Based on these criteria, identify 5‚Äì8 specific job opportunities OR highly targeted places where such jobs are likely posted with less competition than LinkedIn/Indeed.
2. For each result, provide:
   - Job title and company name
   - Location / arrangement (remote/hybrid/onsite)
   - Why it has low visibility / less competition
   - Estimated compensation range if available (include equity if requested)
   ${filters.wlb ? '- Work-life balance signals' : ''}
   ${filters.funding ? '- Company funding stage and amount if known' : ''}
   - Direct URL to apply or where to find it
   - A brief (2-3 sentence) pitch on why this could be a strong fit
   - Fit score: HIGH / MEDIUM / LOW

3. Prioritize results from: direct company career pages, niche boards (Built In, Idealist, B Corp jobs, Work for Good, Greenhouse-hosted listings, state job boards), not syndicated LinkedIn/Indeed posts.

4. Be specific about real companies and real job boards ‚Äî don't be vague. If you can't confirm a live posting, describe exactly where to search (e.g. "search 'data analyst' on General Mills Workday careers page").

Format your response as structured JSON array with this schema:
[
  {
    "title": "Job Title",
    "company": "Company Name",
    "location": "City, State or Remote",
    "arrangement": "Remote/Hybrid/Onsite",
    "fitScore": "HIGH/MEDIUM/LOW",
    "compensation": "Salary range or 'Not listed'",
    "equity": "Stock options / equity info or null",
    "wlb": "WLB signals or null",
    "funding": "Funding stage/amount or null",
    "visibility": "Why this has less competition",
    "summary": "2-3 sentence pitch",
    "applyUrl": "Direct URL or search instruction",
    "source": "Where this job is posted"
  }
]

Return ONLY the JSON array, no other text.`;

    return prompt;
  }

  async function runSearch() {
    const apiKey = document.getElementById('apiKey').value.trim();
    const jobTitle = document.getElementById('jobTitle').value.trim();

    if (!apiKey) {
      showError('Please enter your Anthropic API key above.');
      return;
    }
    if (!jobTitle) {
      showError('Please enter a job title to search for.');
      return;
    }

    const filters = {
      jobTitle,
      location: document.getElementById('location').value.trim(),
      industry: document.getElementById('industry').value.trim(),
      keywords: document.getElementById('keywords').value.trim(),
      companySize: document.getElementById('companySize').value,
      workArrangements: getCheckedValues('workArrangement'),
      salaryMin: document.getElementById('salaryMin').value.trim(),
      salaryMax: document.getElementById('salaryMax').value.trim(),
      payTransparency: document.getElementById('payTransparency').checked,
      equity: document.getElementById('equityToggle').checked,
      wlb: document.getElementById('wlbToggle').checked,
      funding: document.getElementById('fundingToggle').checked,
      fundingStages: getCheckedValues('fundingStage'),
      fundingMin: document.getElementById('fundingMin').value.trim(),
      fundingMax: document.getElementById('fundingMax').value.trim(),
      sources: getCheckedValues('sources'),
      additionalContext: document.getElementById('additionalContext').value.trim(),
    };

    hideError();
    setLoading(true);
    showStatus('Searching across niche job boards and company career pages...');
    clearResults();

    try {
      const response = await fetch('https://api.anthropic.com/v1/messages', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'x-api-key': apiKey,
          'anthropic-version': '2023-06-01',
        },
        body: JSON.stringify({
          model: 'claude-opus-4-6',
          max_tokens: 4000,
          messages: [{ role: 'user', content: buildPrompt(filters) }],
          tools: [{
            type: 'web_search_20250305',
            name: 'web_search',
          }],
        }),
      });

      if (!response.ok) {
        const err = await response.json();
        throw new Error(err.error?.message || `API error ${response.status}`);
      }

      const data = await response.json();
      hideStatus();

      // Extract text content
      let rawText = '';
      for (const block of data.content) {
        if (block.type === 'text') rawText += block.text;
      }

      // Parse JSON
      const jsonMatch = rawText.match(/\[[\s\S]*\]/);
      if (!jsonMatch) {
        // Show raw output if JSON not found
        document.getElementById('streamingOutput').textContent = rawText;
        document.getElementById('streamingOutput').classList.add('visible');
        setLoading(false);
        return;
      }

      const jobs = JSON.parse(jsonMatch[0]);
      renderResults(jobs, filters);

    } catch (err) {
      hideStatus();
      showError(`Error: ${err.message}. Check your API key and try again.`);
    }

    setLoading(false);
  }

  function renderResults(jobs, filters) {
    const container = document.getElementById('resultsContainer');
    const countEl = document.getElementById('resultsCount');

    countEl.textContent = `${jobs.length} result${jobs.length !== 1 ? 's' : ''}`;
    countEl.style.display = 'block';

    container.innerHTML = '';

    jobs.forEach((job, i) => {
      const fitClass = job.fitScore === 'HIGH' ? 'fit-high' : job.fitScore === 'MEDIUM' ? 'fit-med' : 'fit-low';

      const metaTags = [];
      if (job.arrangement) metaTags.push({ label: job.arrangement, highlight: false });
      if (job.source) metaTags.push({ label: job.source, highlight: false });
      if (job.compensation && job.compensation !== 'Not listed') metaTags.push({ label: job.compensation, highlight: true });
      if (job.funding && filters.funding) metaTags.push({ label: job.funding, highlight: false });

      const card = document.createElement('div');
      card.className = 'job-card';
      card.style.animationDelay = `${i * 60}ms`;

      card.innerHTML = `
        <div class="job-card-header">
          <div>
            <div class="job-title">${job.title}</div>
            <div class="job-company">${job.company}</div>
            <div class="job-location">${job.location || ''}</div>
          </div>
          <div class="fit-badge ${fitClass}">${job.fitScore}</div>
        </div>

        <div class="job-meta">
          ${metaTags.map(t => `<span class="meta-tag${t.highlight ? ' highlight' : ''}">${t.label}</span>`).join('')}
        </div>

        <div class="job-summary">${job.summary}</div>

        ${job.equity && filters.equity ? `<div class="job-summary" style="color: var(--accent-dim)">üìà Equity: ${job.equity}</div>` : ''}
        ${job.wlb && filters.wlb ? `<div class="job-summary" style="color: var(--text-dim)">‚öñÔ∏è WLB: ${job.wlb}</div>` : ''}

        <div class="job-card-footer">
          <div class="visibility-note">‚Üì less visible ¬∑ ${job.visibility || 'Niche source'}</div>
          ${job.applyUrl ? `<a class="apply-link" href="${job.applyUrl.startsWith('http') ? job.applyUrl : '#'}" target="_blank" rel="noopener">
            ${job.applyUrl.startsWith('http') ? 'Apply ‚Üí' : job.applyUrl}
          </a>` : ''}
        </div>
      `;

      container.appendChild(card);
    });
  }

  function setLoading(loading) {
    const btn = document.getElementById('searchBtn');
    btn.disabled = loading;
    btn.classList.toggle('loading', loading);
  }

  function showStatus(msg) {
    document.getElementById('statusText').textContent = msg;
    document.getElementById('statusBar').classList.add('visible');
  }

  function hideStatus() {
    document.getElementById('statusBar').classList.remove('visible');
  }

  function showError(msg) {
    const el = document.getElementById('errorMsg');
    el.textContent = msg;
    el.classList.add('visible');
  }

  function hideError() {
    document.getElementById('errorMsg').classList.remove('visible');
  }

  function clearResults() {
    document.getElementById('resultsContainer').innerHTML = '';
    document.getElementById('resultsCount').style.display = 'none';
    document.getElementById('streamingOutput').classList.remove('visible');
    document.getElementById('streamingOutput').textContent = '';
  }

  // Save API key to sessionStorage for convenience
  document.getElementById('apiKey').addEventListener('input', function() {
    sessionStorage.setItem('jscout_key', this.value);
  });

  const savedKey = sessionStorage.getItem('jscout_key');
  if (savedKey) document.getElementById('apiKey').value = savedKey;
</script>

</body>
</html>
